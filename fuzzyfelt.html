<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
		<title>Jakes Fuzzy Felt</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	</head>
	<body>
<div>
<h1>Short Term Tasks</h1>
<canvas id="canvas_short" width=2000 height=600 style="width:380;height:240;" />
</div>
<h1>Future Tasks</h1>
<div>
<canvas id="canvas_future" width=8000 height=600 style="width:380;height:240;" />
</div>

<script type="text/javascript">

Object.getPrototypeOf(document.createElement('canvas').getContext('2d')).fillRectR = function(x,y,w,h,r)
{
	if (typeof r === "undefined")
	{
		r = 5;
	}
	this.beginPath();
	this.moveTo(x + r, y);
	this.lineTo(x + w - r, y);
	this.quadraticCurveTo(x + w, y, x + w, y + r);
	this.lineTo(x + w, y + h - r);
	this.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
	this.lineTo(x + r, y + h);
	this.quadraticCurveTo(x, y + h, x, y + h - r);
	this.lineTo(x, y + r);
	this.quadraticCurveTo(x, y, x + r, y);
	this.closePath();
	this.fill();
};

Object.getPrototypeOf(document.createElement('canvas').getContext('2d')).strokeRectR = function(x,y,w,h,r)
{
	if (typeof r === "undefined")
	{
		r = 5;
	}
	this.beginPath();
	this.moveTo(x + r, y);
	this.lineTo(x + w - r, y);
	this.quadraticCurveTo(x + w, y, x + w, y + r);
	this.lineTo(x + w, y + h - r);
	this.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
	this.lineTo(x + r, y + h);
	this.quadraticCurveTo(x, y + h, x, y + h - r);
	this.lineTo(x, y + r);
	this.quadraticCurveTo(x, y, x + r, y);
	this.closePath();
	this.stroke();
};
</script>
<script type="text/javascript">

const HIGH_PRIORITY = 0;
const MEDIUM_PRIORITY = 1;
const LOW_PRIORITY = 2;
const HIGH_RISK = 3;
const MEDIUM_RISK = 4;
const LOW_RISK = 5;
const TASK_UNDEFINED = 6;
const TASK_DONE = 7;

function TaskItem(owner, title, duration, taskStatus)
{
	this.m_owner = owner;
	this.m_title = title;
	this.m_duration = duration;
	this.m_taskStatus = taskStatus;
};

function FuzzyViewData(cellWidth, cellHeight, weekX, weekY)
{
	this.m_cellWidth = cellWidth;
	this.m_cellHeight = cellHeight;
	this.m_weekX = weekX;
	this.m_weekY = weekY;
};

function getLines(ctx,phrase,maxPxLength)
{
	//break the text area text into lines based on "box" width
	var wa = phrase.split(" ");
	var phraseArray = [];
	var lastPhrase = "";
	var l = maxPxLength;
	var measure = 0;
	for (var i = 0;i < wa.length; i++)
	{
		var w= wa[i];
		measure = ctx.measureText(lastPhrase+w).width;
		if (measure < l)
		{
			lastPhrase += (" "+w);
		}
		else
		{
			phraseArray.push(lastPhrase);
			lastPhrase = w;
		}
		if (i === wa.length-1)
		{
			phraseArray.push(lastPhrase);
			break;
		}
	}
	return phraseArray;
}

function drawColumnLine(ctx, x, y, h)
{
	ctx.strokeStyle = 'rgba(0,0,0,1.0)';
	ctx.lineWidth = 4.0
	ctx.beginPath();
	ctx.moveTo(x, y);
	ctx.lineTo(x, y+h);
	ctx.closePath();
	ctx.stroke();
}

function drawRowLine(ctx, x, y, w)
{
	ctx.strokeStyle = 'rgba(0,0,0,1.0)';
	ctx.lineWidth = 4.0
	ctx.beginPath();
	ctx.moveTo(x, y);
	ctx.lineTo(x+w, y);
	ctx.closePath();
	ctx.stroke();
};

function drawGrid(ctx, cellWidth, cellHeight, numRows, numCols, weekX)
{
	var w = cellWidth*numCols + weekX;
	var h = cellHeight*numRows;

	// Draw the column lines
	var x0 = 0;
	var y0 = 0;
	drawColumnLine(ctx, x0, y0, h);
	x0 = weekX;
	for (var i = 0; i < numCols; i++)
	{
		drawColumnLine(ctx, x0, y0, h);
		x0 += cellWidth;
	};
	drawColumnLine(ctx, x0, y0, h);

	// Draw the row lines
	x0 = 0;
	y0 = 0;
	drawRowLine(ctx, x0, cellHeight/2, w);
	for (var i = 0; i < numRows; i++)
	{
		drawRowLine(ctx, x0, y0, w);
		y0 += cellHeight;
	};
	drawRowLine(ctx, x0, y0, w);
};

function drawTitle(ctx, title, n, titleX, titleY, titleWidth, titleHeight, bgColour)
{
	var x0 = titleX + n*titleWidth;
	var y0 = titleY;

	ctx.shadowOffsetX = 0;
	ctx.shadowOffsetY = 0;
	ctx.shadowBlur = 0;
	ctx.fillStyle = bgColour;
	ctx.lineWidth = 0.0;
	ctx.fillRect(x0, y0, titleWidth, titleHeight);

	var xc = x0 + titleWidth/2;
	var yc = y0 + titleHeight/2;
	ctx.shadowOffsetX = 0;
	ctx.shadowOffsetY = 0;
	ctx.shadowBlur = 0;
	ctx.textAlign = 'center';
	ctx.textBaseline = 'middle';
	ctx.strokeStyle = 'rgba(0,0,0,1.0)';
	ctx.lineWidth  = 4.0;
	ctx.fillStyle = '#000';
	ctx.fillText(title, xc, yc);
};

function drawName(ctx, name, n, nameX, nameY, nameWidth, nameHeight, bgColour)
{
	var x0 = nameX;
	var y0 = nameY + n*nameHeight;

	ctx.shadowOffsetX = 0;
	ctx.shadowOffsetY = 0;
	ctx.shadowBlur = 0;
	ctx.fillStyle = bgColour;
	ctx.lineWidth = 0.0;
	ctx.fillRect(x0, y0, nameWidth, nameHeight);

	var xc = x0 + nameWidth/2;
	var yc = y0 + nameHeight/2;
	ctx.textAlign = 'center';
	ctx.textBaseline = 'middle';
	ctx.strokeStyle = 'rgba(0,0,0,1.0)';
	ctx.lineWidth  = 4.0;
	ctx.fillStyle = '#000';
	ctx.fillText(name, xc, yc);
};

function drawFuzzyFeltElement(ctx,text, x, y, w, h, boxColour)
{
	ctx.shadowOffsetX = 0;
	ctx.shadowOffsetY = 0;
	ctx.shadowBlur    = 0;
	ctx.shadowColor   = 'rgba(0, 0, 0, 0.0)';
	ctx.fillStyle = boxColour;
	ctx.strokeStyle = 'rgba(0,0,0,1.0)';
	ctx.fillRectR(x, y, w, h, 20);
	ctx.lineWidth = 4.0;
	ctx.strokeRectR(x, y, w, h, 20);

	ctx.shadowOffsetX = 3;
	ctx.shadowOffsetY = 3;
	ctx.shadowBlur    = 2;
	ctx.shadowColor   = 'rgba(100, 100, 100, 0.5)';
	ctx.fillStyle    = '#000';
	ctx.textAlign = 'center';
	ctx.textBaseline = 'middle';
	pxHeight = 18;
	linesArray = getLines(ctx, text, w-15);
	numLines = linesArray.length;
	textx = x+w/2;
	texty = y+h/2-(((numLines-1)/2)*pxHeight);
	for (var i=0; i < numLines; i++)
	{
		line = linesArray[i];
		ctx.fillText(line, textx, texty);
		texty += pxHeight;
	};
};

function drawFuzzyFelt(canvas, fuzzyData, names, tasks, weeks)
{
	var ctx = canvas.getContext('2d');
	ctx.font = 'bold 18px sans-serif';

	const numWeeks=weeks.length;
	const numPeople=names.length;

	const cellWidth=fuzzyData.m_cellWidth;
	const cellHeight=fuzzyData.m_cellHeight;
	const weekX=fuzzyData.m_weekX;
	const weekY=fuzzyData.m_weekY;

	const numCols=numWeeks;
	const numRows=numPeople+2;

	const elementHeight=cellHeight-10;

	const weekWidth=cellWidth;

	const nameX=0;
	const nameY=weekY;
	const nameWidth=weekX;
	const nameHeight=cellHeight;

	const titleX=weekX;
	const titleY=0;
	const titleWidth=cellWidth;
	const titleHeight=cellHeight/2;

	var pastelColours=[
		"#FF4848",
		"#06DCFB",
		"#79FC4E",
		"#DFE32D",
		"#DDCEFF",
		"#B4D1B6",
	];

	var boxColours=[
		"#FF0000", // HIGH_PRIORITY = 0;
		"#FFFF00", // MEDIUM_PRIORITY = 1;
		"#00FF00", // LOW_PRIORITY = 2;
		"#FF0000", // HIGH_RISK = 3;
		"#FFFF00", // MEDIUM_RISK = 4;
		"#00FF00", // LOW_RISK = 5;
		"#0000FF", // TASK_UNDEFINED = 6;
		"#707070", // TASK_DONE = 7;
	];

	// Draw week titles
	var pastelColourIndex = 0;
	var lastColourText = '';

	for (var w = 0; w < numWeeks; w++)
	{
		var title = weeks[w];
		if (title != lastColourText)
		{
			pastelColourIndex++;
			if (pastelColourIndex >= pastelColours.length)
			{
				pastelColourIndex = 0;
			};
			lastColourText = title;
		};
		var titleBGcolour = pastelColours[pastelColourIndex];
		drawTitle(ctx, title, w, titleX, titleY, titleWidth, titleHeight, titleBGcolour);
	};

	// Draw name titles
	pastelColourIndex = 0;
	lastColourText = '';

	for (var n = 0; n < numPeople; n++)
	{
		var name = names[n];
		if (name != lastColourText)
		{
			pastelColourIndex++;
			if (pastelColourIndex >= pastelColours.length)
			{
				pastelColourIndex = 0;
			};
			lastColourText = name;
		};
		var nameBGcolour = pastelColours[pastelColourIndex];
		drawName(ctx, name, n, nameX, nameY, nameWidth, nameHeight, nameBGcolour);
	};

	drawGrid(ctx, cellWidth, cellHeight, numRows, numCols, weekX);

	// Draw the fuzzy felt elements
	for(var n = 0; n < numPeople; n++)
	{
		var x0 = weekX;
		var y = weekY + n*cellHeight + (10/2);
		name = names[n];
		for(var i = 0; i < tasks.length; i++)
		{
			var task = tasks[i];
			if (task.m_owner == name)
			{
				var text = task.m_title;
				var duration = task.m_duration;
				var taskStatus = task.m_taskStatus;

				var w = duration * weekWidth - 10;
				var h = elementHeight;
				var x = x0;
				x += (10/2);
				var boxColour = boxColours[taskStatus]

				drawFuzzyFeltElement(ctx,text, x, y, w, h, boxColour);

				x0 += duration * cellWidth;
			};
		};
	};
};
</script>

<script type="text/javascript">
var names=[
	'Jake T',
	'Lee H',
	'Alex W',
	'Baldur K',
	'Michael N',
	'Paul H',
];

var shortTasks=[
	new TaskItem("Jake T", "Task Number 1", 1, LOW_RISK),
	new TaskItem("Jake T", "Task Number 2", 1, LOW_RISK),
	new TaskItem("Jake T", "Task Number 3", 1, LOW_RISK),
	new TaskItem("Lee H", "Lee Task 1", 1, HIGH_RISK),
	new TaskItem("Lee H", "Lee Task 2", 1, LOW_RISK),
	new TaskItem("Alex W", "Alex Task 1", 1, LOW_RISK),
	new TaskItem("Alex W", "Alex Task 2", 1, MEDIUM_RISK),
	new TaskItem("Alex W", "Alex Task 3", 1, LOW_RISK),
	new TaskItem("Baldur K", "Baldur Task 1", 1, TASK_DONE),
	new TaskItem("Baldur K", "Baldur Task 2", 1, TASK_DONE),
	new TaskItem("Baldur K", "Baldur Task 3", 1, HIGH_RISK),
	new TaskItem("Michael N", "Mike Task 1", 1, TASK_UNDEFINED),
	new TaskItem("Michael N", "Mike Task 2", 1, LOW_RISK),
	new TaskItem("Michael N", "Mike Task 3", 1, LOW_RISK),
	new TaskItem("Paul H", "Paul H Task 1", 1, LOW_RISK),
	new TaskItem("Paul H", "Paul H Task 2", 1, LOW_RISK),
	new TaskItem("Paul H", "Paul H Task 3", 1, LOW_RISK),
];

var futureTasks=[
	new TaskItem("Jake T", "Future Task Number 1", 1, LOW_PRIORITY),
	new TaskItem("Jake T", "Future Task Number 2", 3, LOW_PRIORITY),
	new TaskItem("Jake T", "Future Task Number 3", 2, LOW_PRIORITY),
	new TaskItem("Lee H", "Future Lee Task 1", 2, MEDIUM_PRIORITY),
	new TaskItem("Lee H", "Future Lee Task 2", 1, MEDIUM_PRIORITY),
	new TaskItem("Alex W", "Future Alex Task 1", 3, MEDIUM_PRIORITY),
	new TaskItem("Alex W", "Future Alex Task 2", 1, MEDIUM_PRIORITY),
	new TaskItem("Alex W", "Future Alex Task 3", 2, MEDIUM_PRIORITY),
	new TaskItem("Baldur K", "Baldur Future Task 1", 2, HIGH_PRIORITY),
	new TaskItem("Baldur K", "Baldur Future Task 2", 2, HIGH_PRIORITY),
	new TaskItem("Baldur K", "Baldur Future Task 3", 1, HIGH_PRIORITY),
	new TaskItem("Michael N", "Mike Future Task 1", 1, HIGH_PRIORITY),
	new TaskItem("Michael N", "Mike Future Task 2", 2, HIGH_PRIORITY),
	new TaskItem("Michael N", "Mike Future Task 3", 1, HIGH_PRIORITY),
	new TaskItem("Paul H", "Paul H Future Task 1", 2, HIGH_PRIORITY),
	new TaskItem("Paul H", "Paul H Future Task 2", 1, HIGH_PRIORITY),
	new TaskItem("Paul H", "Paul H Future Task 3", 2, HIGH_PRIORITY),
];

var shortWeeks=[
	'November',
	'November',
	'November',
	'November',
];

var futureWeeks=[ 
	'December',
	'December',
	'December',
	'December',
	'January',
	'January',
	'January',
	'January',
	'February',
	'February',
	'February',
	'February',
	'March',
	'March',
	'March',
	'March',
];

var shortCanvas = document.getElementById("canvas_short");
var futureCanvas = document.getElementById("canvas_future");

const cellWidth=200;
const cellHeight=100;
const weekX=100;
const weekY=cellHeight;
var fuzzyViewData = new FuzzyViewData(cellWidth, cellHeight, weekX, weekY)
drawFuzzyFelt(shortCanvas, fuzzyViewData, names, shortTasks, shortWeeks);

fuzzyViewData.m_cellWidth=150
drawFuzzyFelt(futureCanvas, fuzzyViewData, names, futureTasks, futureWeeks);

</script>
</div>
</body>
</html>

