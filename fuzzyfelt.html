<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
		<title>Jakes Fuzzy Felt</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	</head>
	<body>
<div>
<script type="text/javascript">
Object.getPrototypeOf(document.createElement('canvas').getContext('2d')).fillRectR = function(x,y,w,h,r) {
	if (typeof r === "undefined") {
		r = 5;
	}
	this.beginPath();
	this.moveTo(x + r, y);
	this.lineTo(x + w - r, y);
	this.quadraticCurveTo(x + w, y, x + w, y + r);
	this.lineTo(x + w, y + h - r);
	this.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
	this.lineTo(x + r, y + h);
	this.quadraticCurveTo(x, y + h, x, y + h - r);
	this.lineTo(x, y + r);
	this.quadraticCurveTo(x, y, x + r, y);
	this.closePath();
	this.fill();
};
Object.getPrototypeOf(document.createElement('canvas').getContext('2d')).strokeRectR = function(x,y,w,h,r) {
	if (typeof r === "undefined") {
		r = 5;
	}
	this.beginPath();
	this.moveTo(x + r, y);
	this.lineTo(x + w - r, y);
	this.quadraticCurveTo(x + w, y, x + w, y + r);
	this.lineTo(x + w, y + h - r);
	this.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
	this.lineTo(x + r, y + h);
	this.quadraticCurveTo(x, y + h, x, y + h - r);
	this.lineTo(x, y + r);
	this.quadraticCurveTo(x, y, x + r, y);
	this.closePath();
	this.stroke();
};
</script>
<canvas id="canvas_final" width=600 height=400 style="width:380;height:240;" />
<script type="text/javascript">

function getLines(ctx,phrase,maxPxLength) {
	//break the text area text into lines based on "box" width
	var wa=phrase.split(" "),
			phraseArray=[],
			lastPhrase="",
			l=maxPxLength,
			measure=0;
	for (var i=0;i<wa.length;i++) {
		var w=wa[i];
		measure=ctx.measureText(lastPhrase+w).width;
		if (measure<l) {
			lastPhrase+=(" "+w);
		}else {
			phraseArray.push(lastPhrase);
			lastPhrase=w;
		}
		if (i===wa.length-1) {
			phraseArray.push(lastPhrase);
			break;
		}
	}
	return phraseArray;
}

var canvas = document.getElementById("canvas_final");
var context2d = canvas.getContext('2d');

context2d.font = 'bold 18px sans-serif';
for(var i=0; i<4; i++) {
	text = 'Four Fiver Twelve!'
	w=150
	h=70
	x=10
	y=10+i*(h+8)
	boxColour = 'rgba('+(255-i*80)+','+(128+i*40)+','+i*80+',0.33)';
	drawFuzzyFeltElement(context2d,text, x, y, w, h, boxColour)
};

function drawFuzzyFeltElement(ctx,text, x, y, w, h, boxColour) {
	ctx.shadowOffsetX = 0;
	ctx.shadowOffsetY = 0;
	ctx.shadowBlur    = 0;
	ctx.shadowColor   = 'rgba(0, 0, 0, 0.0)';
	ctx.fillStyle = boxColour;
	ctx.strokeStyle = 'rgba(0,0,0,1.0)';
	ctx.fillRectR(x, y, w, h, 20);
	ctx.lineWidth = 4.0
	ctx.strokeRectR(x, y, w, h, 20);

	ctx.shadowOffsetX = 3;
	ctx.shadowOffsetY = 3;
	ctx.shadowBlur    = 2;
	ctx.shadowColor   = 'rgba(100, 100, 100, 0.5)';
	ctx.fillStyle    = '#000';
	ctx.textAlign = 'center';
	ctx.textBaseline = 'middle';
	pxHeight = 18
	linesArray = getLines(ctx, text, w-15)
	numLines = linesArray.length
	textx = x+w/2
	texty = y+h/2-(((numLines-1)/2)*pxHeight)
	for (var i=0; i < numLines; i++) {
		line = linesArray[i]
		ctx.fillText(line, textx, texty);
		texty += pxHeight
	};
};

</script>
</div>
</body>
</html>

